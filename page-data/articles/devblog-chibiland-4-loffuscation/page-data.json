{"componentChunkName":"component---src-articles-template-tsx","path":"/articles/devblog-chibiland-4-loffuscation/","result":{"data":{"mdx":{"id":"411426c4-f38f-52b7-b5fc-0c0465ea9891","slug":"devblog-chibiland-4-loffuscation/","tableOfContents":{},"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"created_time\": \"2022-10-01T00:00:00.000Z\",\n  \"last_edited_time\": \"2023-05-05T13:14:00.000Z\",\n  \"slug\": \"devblog-chibiland-4-loffuscation\",\n  \"title\": \"Devblog Chibiland #4 — L’offuscation\",\n  \"tags\": [\"Chibiland\"],\n  \"icon_image\": \"./images/icon.png\"\n};\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\nvar LinkPreview = makeShortcode(\"LinkPreview\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Petit article un peu hors-s\\xE9rie pour parler de l\\u2019offuscation JavaScript car je trouvais ce sujet int\\xE9ressant. \"), mdx(\"p\", null, \"Attention cet article-l\\xE0 est technique \\uD83E\\uDDD1\\u200D\\uD83D\\uDCBB\"), mdx(\"p\", null, \"Cela fait un moment que \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/javascript-obfuscator/javascript-obfuscator\"\n  }, \"l\\u2019offuscateur JavaScript que j\\u2019utilisais\"), \" m\\u2019emb\\xEAtait (pour ne pas dire un mot plus vulgaire).\"), mdx(\"p\", null, \"En fait dans sa configuration la moins brutale on se retrouve avec ce genre de choses en sortie :\"), mdx(\"span\", {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1024px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/d42ad28ae8106d1a763b2c0618d6a062/b67f3/9d338a64-4951-469e-a124-2716b2d158ec.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"41.79687500000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQ0lEQVQoz01S2Y6DMAzk/z9wIYlzUFjuqrBS+1BoZzUGuhvJshMSz2GylCJCjPDeg3VKCSFEXC4XhBCQUokYI8oyIfig3xkigrIs0bYtvusa1+sV27YhizHAOQdjjGZrLazda2OtZu+DAjrr4JzoHa2tVcBhGHC73fB6vZARhZe9iGZxDuJE2caDOXMMe02WZKfhBFVVYRwnLPOC53NFVlIiHxwNKHNvLHAiCATzu4r/wXt1VavkruuwLD9Y1xVZCB6WrBTVfx6wKaXx3B3frXX4ynMUhVGLeEaGbPh4PHbJpywyUmkxaRCI/lJq0zQYxxHjMGKaJszzrPu+79Ef/rGhDoUscqLmhaJybwoDa+yHbVEU8F4+lpw+kgjZ3e93vN9vcGV/wxB48cro9JET5Z5W0CtOk7ltGnRtp7/KyYyLTX8BqUhHDRg0fj8AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"image\",\n    \"title\": \"image\",\n    \"src\": \"/static/d42ad28ae8106d1a763b2c0618d6a062/2bef9/9d338a64-4951-469e-a124-2716b2d158ec.png\",\n    \"srcSet\": [\"/static/d42ad28ae8106d1a763b2c0618d6a062/6f3f2/9d338a64-4951-469e-a124-2716b2d158ec.png 256w\", \"/static/d42ad28ae8106d1a763b2c0618d6a062/01e7c/9d338a64-4951-469e-a124-2716b2d158ec.png 512w\", \"/static/d42ad28ae8106d1a763b2c0618d6a062/2bef9/9d338a64-4951-469e-a124-2716b2d158ec.png 1024w\", \"/static/d42ad28ae8106d1a763b2c0618d6a062/b67f3/9d338a64-4951-469e-a124-2716b2d158ec.png 1338w\"],\n    \"sizes\": \"(max-width: 1024px) 100vw, 1024px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \"), mdx(\"p\", null, \"A premi\\xE8re vue le code est difficile \\xE0 comprendre ; chaque propri\\xE9t\\xE9 est remplac\\xE9e par une cha\\xEEne al\\xE9atoire \\xE0 base d\\u2019hexad\\xE9cimal\\u2026 Cependant, dans cette configuration l\\u2019offuscateur conserve la correspondance entre ces cha\\xEEnes al\\xE9atoires et leur valeur initiale pour ne pas casser le code.\"), mdx(\"p\", null, \"Par exemple on aura :\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"javascript\",\n    \"line-numbers\": \"true\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const player = {username: \\\"Flamiche\\\"};\"), \"\\n        \"), mdx(\"p\", null, \"Qui deviendra :\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"javascript\",\n    \"line-numbers\": \"true\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const a = {\\\"0x5fd5a\\\": \\\"Flamiche\\\"};\\n\\n// Avec quelque part la correspondance :\\n\\\"0x5fd5a\\\" -> \\\"username\\\"\"), \"\\n        \"), mdx(\"p\", null, \"Ce qui signifie que techniquement le processus est r\\xE9versible !\"), mdx(\"p\", null, \"Et en effet avec un script \\xE0 base d\\u2019\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/eval\"\n  }, \"eval\"), \" de ce style, il est possible de remettre les cha\\xEEnes originale \\xE0 leur place et retrouver un code proche de celui en sortie de minimisation.\"), mdx(LinkPreview, {\n    caption: \"\",\n    url: \"https://gist.github.com/Feavy/628913854683fcb396649401eeb2137e\",\n    mdxType: \"LinkPreview\"\n  }), mdx(\"p\", null, \"Au final cette offuscation devient presque contre-productive car elle impacte n\\xE9gativement les performances et alourdit les fichiers sans pour autant rendre le code plus compliqu\\xE9 \\xE0 comprendre vu que le processus peut \\xEAtre invers\\xE9.\"), mdx(\"p\", null, \"Finalement \\xE7a ne fait plus qu\\u2019office de barri\\xE8re \\xE0 l\\u2019entr\\xE9e.\"), mdx(\"p\", null, \"Mais \\xE7a c\\u2019est pour la version \\u201Csoft\\u201D.\"), mdx(\"p\", null, \"Car en effet, en activant certaines options il y a possibilit\\xE9 de vraiment renommer les propri\\xE9t\\xE9s sans garder les originales ! Cela se fait via les options \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"renameProperties\"), \" et \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"renameGlobals\")), mdx(\"p\", null, \"Mais les utiliser sans casser le code est compliqu\\xE9.\"), mdx(\"p\", null, \"Pour les utiliser sans (trop de) probl\\xE8me avec Chibiland j\\u2019\\xE9tais oblig\\xE9 de maintenir un \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/Feavy/javascript-obfuscator-1/\"\n  }, \"fork du projet\"), \" car il fallait parvenir \\xE0 renommer toutes les propri\\xE9t\\xE9s du jeu \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"mais pas celles du moteur Phaser (et autres biblioth\\xE8ques)\"), \", sinon le lien entre les sources \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"em\", {\n    parentName: \"strong\"\n  }, \"vendor\")), \" et les sources du jeu serait perdu.\"), mdx(\"p\", null, \"L\\u2019offuscateur propose une option \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"reservedNames\"), \" pour pallier ce probl\\xE8me. Comme son nom l\\u2019indique elle permet de r\\xE9server des noms de propri\\xE9t\\xE9s \\xE0 ne pas modifier.\"), mdx(\"p\", null, \"Cependant cette propri\\xE9t\\xE9 prend comme valeur une liste de \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"RegExp \"), \"que les propri\\xE9t\\xE9s \\xE0 conserver doivent matcher. Or avec les biblioth\\xE8ques que j\\u2019utilise \\xE7a fait plus de 6000 noms de propri\\xE9t\\xE9s r\\xE9serv\\xE9s\\u2026 donc 6000 RegExp \\xE0 tester !\"), mdx(\"p\", null, \"C\\u2019\\xE9tait extr\\xEAmement co\\xFBteux et en pratique \\xE7a n\\u2019allait jamais jusqu\\u2019au bout.\"), mdx(\"figure\", {\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1024px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/6e04914c74ecdc65cd7b978e11f6db4d/2eb79/e0690cc0-349f-464f-b2c0-db78af8b9850.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"50.390625%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVQoz21SWw6EMAjc+59IjVfQE2gtrcZ3jDHxl83QYupmPwyoMMwMfKy1jKf3nr33TEQSm6aR3DknETXIjTFsuo5drFmWhfd957Isua5r/qDIdt0DpAPw3qHROYlk6RnYGsNEAXyeZwEtioKrquJPOl2BlBkafB+YI8c3HaDg4zgKaJ7nARAgKEiLNEcUO/r+xVaHT9PEx3H8AtIzHY2Q1rYte9+/AFI/FRD1kAvAR7IyVDkps7//4nAQWeaFr+t6PJSloMj9+DgMA1PilYKJguixMoVsZSiAqYSwFCey00ZlTLEGjyo5z5PXdRUPX4DapKejDWBl5ExCndftx83jBrdt4yzLgoemNX9uL4D5GIVptAQ5DtsSiTX3fT8MAfgFrVXSJTPhRaMAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Quelques mots-clés de Phaser et PlanckJS\",\n    \"title\": \"Quelques mots-clés de Phaser et PlanckJS\",\n    \"src\": \"/static/6e04914c74ecdc65cd7b978e11f6db4d/2bef9/e0690cc0-349f-464f-b2c0-db78af8b9850.png\",\n    \"srcSet\": [\"/static/6e04914c74ecdc65cd7b978e11f6db4d/6f3f2/e0690cc0-349f-464f-b2c0-db78af8b9850.png 256w\", \"/static/6e04914c74ecdc65cd7b978e11f6db4d/01e7c/e0690cc0-349f-464f-b2c0-db78af8b9850.png 512w\", \"/static/6e04914c74ecdc65cd7b978e11f6db4d/2bef9/e0690cc0-349f-464f-b2c0-db78af8b9850.png 1024w\", \"/static/6e04914c74ecdc65cd7b978e11f6db4d/2eb79/e0690cc0-349f-464f-b2c0-db78af8b9850.png 1256w\"],\n    \"sizes\": \"(max-width: 1024px) 100vw, 1024px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }, \"Quelques mots-cl\\xE9s de Phaser et PlanckJS\"), \"\\n  \"), mdx(\"p\", null, \"Ce fork \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/Feavy/javascript-obfuscator-1/commit/e45a6bb37a163d3655c7ea6d4f3ad33206c9b9b7\"\n  }, \"ajoutait donc une option (exactReservedNames)\"), \" pour ignorer des propri\\xE9t\\xE9s pr\\xE9cises \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"sans utiliser de RegExp\"), \", ce qui permettait de tester toutes les propri\\xE9t\\xE9s du jeu en un temps raisonnable.\"), mdx(\"p\", null, \"Mais Chibiland poss\\xE8de lui aussi son lot de mots r\\xE9serv\\xE9s. Et donc avant chaque mise en production, le jeu \\xE9tait cass\\xE9 et je devais deviner les nouveaux mots r\\xE9serv\\xE9s \\xE0 ajouter jusqu\\u2019\\xE0 temps qu\\u2019il fonctionne \\xE0 nouveau\\u2026 C\\u2019\\xE9tait assez fastidieux.\"), mdx(\"p\", null, \"Et avec le passage \\xE0 SolidJS cela aurait ajout\\xE9 encore plein de mots r\\xE9serv\\xE9s \\xE0 trouver\\u2026 j\\u2019avais la flemme.\"), mdx(\"p\", null, \"Alors j\\u2019ai pris le probl\\xE8me dans le sens inverse.\"), mdx(\"p\", null, \"Plut\\xF4t que donner une liste de mots r\\xE9serv\\xE9s, pourquoi ne pas donner une liste de mots \\xE0 masquer?\"), mdx(\"p\", null, \"C\\u2019est ce que j\\u2019ai fait avec le \\u201CChibi Obfuscator\\u201D, un plugin WebPack tout b\\xEAte qui fait du search-and-replace \\xE0 travers le code en sortie de compilation, afin de masquer certaines propri\\xE9t\\xE9s.\"), mdx(\"p\", null, \"Le proc\\xE9d\\xE9 reste encore tr\\xE8s artisanal avec le besoin d\\u2019\\xE9num\\xE9rer toutes les propri\\xE9t\\xE9s \\xE0 masquer. L\\u2019id\\xE9al serait de pouvoir les trouver automatiquement dans le code source mais je n\\u2019ai pas encore eu l\\u2019occasion de me pencher l\\xE0-dessus (\\xE7a pourrait se faire facilement avec ts-node).\"), mdx(\"p\", null, \"Avec tout \\xE7a je ne sais m\\xEAme plus si c\\u2019est vraiment utile d\\u2019offusquer le code avec l\\u2019outil dont je vous ai parl\\xE9, je vais le laisser pour l\\u2019instant, par acquis de conscience, mais je pencherai plus en profondeur sur la question dans le futur.\"), mdx(\"p\", null, \"Voil\\xE0 pour ce qui est de l\\u2019offuscation. C\\u2019est peut-\\xEAtre pas tr\\xE8s judicieux de parler de cet aspect de s\\xE9curit\\xE9 dans un article mais je tenais \\xE0 le faire car ce sujet m\\u2019int\\xE9resse beaucoup.\"), mdx(\"p\", null, \"J\\u2019ai souvent \\xE9t\\xE9 de l\\u2019autre c\\xF4t\\xE9 de la barri\\xE8re, \\xE0 essayer de comprendre du code offusqu\\xE9, notamment pour des jeux Flash comme DarkOrbit :\"), mdx(LinkPreview, {\n    url: \"https://github.com/Feavy/darkorbit_preloader\",\n    mdxType: \"LinkPreview\"\n  }), mdx(LinkPreview, {\n    url: \"https://github.com/Feavy/Darkorbit-main.swf-decrypter\",\n    mdxType: \"LinkPreview\"\n  }), mdx(\"p\", null, \"Pour Flash l\\u2019offuscation \\xE9tait quand-m\\xEAme beaucoup plus pertinente car les sources \\xE9tant compil\\xE9es en bytecode, leur d\\xE9compilation et analyse d\\xE9pendait de la qualit\\xE9 des d\\xE9compilateurs \\xE0 disposition. Le processus \\xE9tait rendu bien plus difficile que pour JavaScript o\\xF9 tous les outils de debug n\\xE9cessaires sont int\\xE9gr\\xE9s directement dans le navigateur et o\\xF9 il est m\\xEAme possible d\\u2019interagir avec le code en temps r\\xE9el.\"), mdx(\"p\", null, \"JavaScript est par nature un langage dont on ne peut pas masquer les algorithmes, la seule chose que l\\u2019on peut faire est de les rendre plus compliqu\\xE9s \\xE0 comprendre. Mais avec le temps suffisant il sera toujours possible de retrouver les originaux.\"), mdx(\"p\", null, \"C\\u2019est pourquoi utiliser l\\u2019offuscation pour emp\\xEAcher la triche dans un jeu web multijoueur est une fausse solution, si la triche doit \\xEAtre bloqu\\xE9e quelque part, c\\u2019est c\\xF4t\\xE9 serveur que \\xE7a doit se passer.\"), mdx(\"p\", null, \"Cela \\xE9voluera peut-\\xEAtre dans le futur avec la popularisation de WebAssembly, qui ne permet pas de retrouver le code source apr\\xE8s compilation. C\\u2019est d\\u2019ailleurs une des raisons qui m\\u2019avait pouss\\xE9 \\xE0 cr\\xE9er le Cherry Engine, un moteur de jeu web C++.\"), mdx(\"p\", null, \"Mais pour en savoir plus il faudra lire l\\u2019article suivant \\uD83D\\uDE09\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Suite :\")), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/articles/devblog-chibiland-5-de-phaser-vers-le-chibi-engine\"\n  }, \"Devblog Chibiland #5 \\u2014 De Phaser vers le Chibi Engine\")), mdx(\"p\", null, \"Page not found 23835940-46b0-445d-8dc3-74a45065838f\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Devblog Chibiland #4 — L’offuscation","tags":["Chibiland"],"created_time":"01 octobre 2022","last_edited_time":"05 mai 2023 à 13:14"}}},"pageContext":{"id":"411426c4-f38f-52b7-b5fc-0c0465ea9891","custom":true}},"staticQueryHashes":[]}